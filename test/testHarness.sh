#!/bin/bash

SERIES_STRATEGIES=(\

### March series with V1 strategies (except for USDT which uses V2 strategy)
### March seriesId, June seriesId, March Strategy address, June Pool address, at time of writing
0x303030390000,0x0030FF00028B,0xcf30A5A994f9aCe5832e30C138C9697cda5E1247,0xD129B0351416C75C9f0623fB43Bb93BB4107b2A4\ 
0x303130390000,0x0031FF00028B,0x7ACFe277dEd15CabA6a8Da2972b1eb93fe1e2cCD,0xC2a463278387e649eEaA5aE5076e283260B0B1bE\
0x303230390000,0x0032FF00028B,0xFBc322415CBC532b54749E31979a803009516b5D,0x06aaF385809c7BC00698f1E266eD4C78d6b8ba75\
0x313830390000,0x0138FF00028B,0x1565F539E96c4d440c38979dbc86Fd711C995DD6,0x2E8F62e3620497DbA8A2D7A18EA8212215805F22\
0x00A0FF000288,0x00A0FF00028B,0x428e229aC5BC52a2e07c379B2F486fefeFd674b1,0xB4DbEc738Ffe47981D337C02Cb5746E456ecd505

### June series with V2 strategies
### June seriesId, March seriesId, June Strategy address, March Pool address, at time of writing
0x0030FF00028B,0x303030390000,0xb268E2C85861B74ec75fe728Ae40D9A2308AD9Bb,0x1b2145139516cB97568B76a2FdbE37D2BCD61e63\ 
0x0031FF00028B,0x303130390000,0x9ca2a34ea52bc1264D399aCa042c0e83091FEECe,0xBdc7Bdae87dfE602E91FDD019c4C0334C38f6A46\ 
0x0032FF00028B,0x303230390000,0x5dd6DcAE25dFfa0D46A04C9d99b4875044289fB2,0x48b95265749775310B77418Ff6f9675396ABE1e8\ 
0x0138FF00028B,0x313830390000,0x4B010fA49E8b673D0682CDeFCF7834328076748C,0x1D2eB98042006B1bAFd10f33743CcbB573429daa\ 
0x00A0FF00028B,0x00A0FF000288,0xF708005ceE17b2c5Fe1a01591E32ad6183A12EaE,0x7472DF92Ae587f97939de92bDFC23dbaCD8a3816\ 

)

ILK_IDS=(\ 
  0x3030 # ETH \ 
  0x3031 # DAI \ 
  0x3032 # USDC \ 
  0x3033 # WBTC \ 
  0x3034 # WSTETH \ 
  0x3036 # LINK \ 
  0x3037 # ENS \ 
  # # 0x3039 # YVUSDC \ 
  0x3130 # UNI \ 
  0x3138 # FRAX \ 
  # 0x3330 # YSDAI6MMSASSET \ 
  # 0x3331 # YSDAI6MJDASSET \ 
  # 0x3332 # YSUSDC6MMSASSET \ 
  # 0x3333 # YSUSDC6MJDASSET \ 
  # 0x3334 # YSETH6MMSASSET \ 
  # 0x3335 # YSETH6MJDASSET \ 
  # 0x3336 # YSFRAX6MMSASSET \ 
  # 0x3337 # YSFRAX6MJDASSET \ 
  # 0x3338 # CRAB \ 
  # 0x30A0 # USDT\

  # ERC1155
  # 0x3132 # FDAI2203 \ 
  # 0x3133 # FUSDC2203 \ 
  # 0x3134 # FDAI2206 \ 
  # 0x3135 # FUSDC2206 \ 
  # 0x3136 # FDAI2209 \ 
  # 0x3137 # FUSDC2209 \ 
  # 0x3233 # FDAI2212 \ 
  # 0x3234 # FUSDC2212 \ 
  # 0x3235 # FDAI2303 \ 
  # 0x3236 # FUSDC2303 \ 
  # 0x3238 # FETH2212 \ 
  # 0x3239 # FETH2303 \ 
)

# Not ilks
# 0x3035 # STETH \ 
# 0x3038 # YVDAI \ 
# 0x3131 # MKR \ 
# 0x3139 # CVX3CRV \ 
# 0x3230 # EWETH \ 
# 0x3231 # EDAI \ 
# 0x3232 # EUSDC \ 
# 0x3237 # EFRAX \ 
# 0x3339 # OSQTH \ 

export RPC="MAINNET"
export NETWORK="MAINNET"
export MOCK=false
export RECTIFY=false

for SERIES_STRATEGY in ${SERIES_STRATEGIES[@]}; do
  SERIES_ID_=`echo $SERIES_STRATEGY | sed 's/,.*//'`
  ROLL_SERIES_ID_=`echo $SERIES_STRATEGY | sed 's/^[^,]*,//;s/,.*//'`
  STRATEGY_=`echo $SERIES_STRATEGY | sed 's/^[^,]*,[^,]*,\([^,]*\).*/\1/'`
  ROLL_POOL_=`echo $SERIES_STRATEGY | sed 's/.*,//'`
  for ILK_ID_ in ${ILK_IDS[@]}; do
    echo "SeriesId:       " $SERIES_ID_
    echo "Roll SeriesId:  " $ROLL_SERIES_ID_
    echo "IlkId:          " $ILK_ID_
    echo "Strategy:       " $STRATEGY_
    echo "Roll Pool:      " $ROLL_POOL_
    STRATEGY=$STRATEGY_ SERIES_ID=$SERIES_ID_ ROLL_SERIES_ID=$ROLL_SERIES_ID_ ILK_ID=$ILK_ID_ ROLL_POOL=$ROLL_POOL_ forge test -c test/RecipeHarness.t.sol

    # For ERC1155 tests 
    # STRATEGY=$STRATEGY_ SERIES_ID=$SERIES_ID_ ROLL_SERIES_ID=$ROLL_SERIES_ID_ ILK_ID=$ILK_ID_ ROLL_POOL=$ROLL_POOL_ forge test -c test/RecipeHarness.t.sol -vvvv --match-test testPostERC1155Collateral
    # STRATEGY=$STRATEGY_ SERIES_ID=$SERIES_ID_ ROLL_SERIES_ID=$ROLL_SERIES_ID_ ILK_ID=$ILK_ID_ ROLL_POOL=$ROLL_POOL_ forge test -c test/RecipeHarness.t.sol -vvvv -m testWithdrawERC1155Collateral
  done
done
